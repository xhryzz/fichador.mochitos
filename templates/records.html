
{% extends 'base.html' %}
{% block title %}Mis Registros{% endblock %}
{% block content %}
<div class="container" style="max-width:1000px;margin:auto">
  <div class="d-flex" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
    <h2 style="margin:0">Mis Registros</h2>
    <a href="{{ url_for('user_add_record') }}" class="btn btn-primary">+ Nuevo fichaje</a>
  </div>

  {% if records.items|length == 0 %}
    <div class="card" style="padding:20px;border:1px solid #e5e7eb;border-radius:12px;background:#fafafa;text-align:center">
      <p style="margin:0 0 10px 0">No hay registros.</p>
      <a class="btn btn-primary" href="{{ url_for('user_add_record') }}">Crear mi primer fichaje</a>
    </div>
  {% else %}
    <div class="table-responsive">
      <table class="table" style="width:100%">
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Entrada</th>
            <th>Salida</th>
            <th>Duración</th>
            <th>Ubicación</th>
            <th>Coordenadas</th>
            <th>Notas</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for record in records.items %}
          <tr>
            <td>{{ record.date.strftime('%d/%m/%Y') }}</td>
            <td>{{ record.entry_time.strftime('%H:%M') }}</td>
            <td>{{ record.exit_time.strftime('%H:%M') if record.exit_time else 'En curso' }}</td>
            <td>
              {% if record.exit_time %}
                {% set secs = (record.exit_time - record.entry_time).total_seconds() %}{{ secs|hhmm }} — {{ secs|minutes }} min
              {% else %}
                -
              {% endif %}
            </td>
            <td>{{ record.location or '' }}</td>
            <td>
              {% if record.latitude and record.longitude %}
                {{ '%.6f'|format(record.latitude) }}, {{ '%.6f'|format(record.longitude) }}
              {% endif %}
            </td>
            <td>{{ record.notes or '' }}</td>
            <td>
              <a class="btn btn-sm btn-outline-primary" href="{{ url_for('user_edit_record', record_id=record.id) }}">Editar</a>
              <form method="POST" action="{{ url_for('user_delete_record', record_id=record.id) }}" style="display:inline" onsubmit="return confirm('¿Eliminar este fichaje?')">
                <button class="btn btn-sm btn-outline-danger" type="submit">Eliminar</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    {% if records.pages > 1 %}
    <nav aria-label="Paginación" style="margin-top:12px">
      <ul class="pagination">
        <li class="page-item {% if not records.has_prev %}disabled{% endif %}">
          <a class="page-link" href="{{ url_for('records', page=records.prev_num) if records.has_prev else '#' }}">Anterior</a>
        </li>
        <li class="page-item disabled"><span class="page-link">Página {{ records.page }} de {{ records.pages }}</span></li>
        <li class="page-item {% if not records.has_next %}disabled{% endif %}">
          <a class="page-link" href="{{ url_for('records', page=records.next_num) if records.has_next else '#' }}">Siguiente</a>
        </li>
      </ul>
    </nav>
    {% endif %}
  {% endif %}
</div>
{% endblock %}
